# =============================================================================
# CONFIGURACIÓN POR DEFECTO DEL PIPELINE DE ANÁLISIS DE SNVs EN miRNAs
# =============================================================================
# Autor: César Esparza
# Fecha: Octubre 15, 2025
# Descripción: Configuración centralizada y flexible para el pipeline
# =============================================================================

# =============================================================================
# CONFIGURACIÓN DE RUTAS
# =============================================================================

paths:
  # Rutas de datos
  data:
    raw_data: "data/raw/miRNA_count.Q33.txt"
    example_data: "data/example_input_mini.tsv"
    processed_data: "outputs/"
  
  # Rutas de salida por módulo
  outputs:
    step_01_prep: "outputs/step_01_prep/"
    step_02_general: "outputs/step_02_general/"
    step_03_gt_specific: "outputs/step_03_gt_specific/"
    step_04_positional: "outputs/step_04_positional/"
    step_05_gt_seed: "outputs/step_05_gt_seed/"
    step_06_advanced: "outputs/step_06_advanced/"
  
  # Subdirectorios estándar
  subdirs:
    figures: "figures/"
    tables: "tables/"
    reports: "reports/"
    metadata: "metadata/"

# =============================================================================
# PARÁMETROS DE FILTRADO
# =============================================================================

filtering:
  # VAF (Variant Allele Frequency) filtering
  vaf_filtering:
    threshold: 0.5                    # VAF > 50% → NaN (isoformas, no oxidación)
    action: "to_nan"                  # "to_nan" | "remove" | "keep"
    justification: "High VAFs likely represent miRNA isoforms, isomiRs, or undescribed miRNAs rather than oxidation damage"
  
  # Coverage filtering
  coverage_filtering:
    min_coverage: 10                  # Mínimo reads totales para incluir miRNA
    min_samples: 1                    # Mínimo muestras con cobertura > min_coverage
  
  # Quality filtering
  quality_filtering:
    remove_zero_totals: true          # Remover filas donde total = 0
    remove_na_proportion: 0.8         # Remover SNVs con >80% valores NA

# =============================================================================
# CONFIGURACIÓN DE ANÁLISIS
# =============================================================================

analysis:
  # Regiones funcionales de miRNAs
  position_analysis:
    seed_region: [2, 3, 4, 5, 6, 7, 8]    # Región seed canónica (5' a 3')
    central_region: [9, 10, 11, 12, 13, 14, 15]  # Región central
    tail_region: [16, 17, 18, 19, 20, 21, 22, 23]  # Región 3' tail
  
  # Tipos de mutaciones de interés
  mutation_types:
    oxidation_proxy: ["G>T"]          # Proxy para 8-oxo-guanosina
    all_types: ["A>C", "A>G", "A>T", "C>A", "C>G", "C>T", "G>A", "G>C", "G>T", "T>A", "T>C", "T>G"]
  
  # Análisis por grupos
  group_analysis:
    cohort_column: "cohort"           # Columna para grupos (ALS vs Control)
    cohorts:
      - "ALS"
      - "control"
  
  # Análisis temporal (si aplica)
  temporal_analysis:
    timepoint_column: "timepoint"     # Columna para puntos temporales
    timepoints:
      - "enrolment"
      - "longitudinal_2"
      - "longitudinal_3"
      - "longitudinal_4"

# =============================================================================
# PARÁMETROS ESTADÍSTICOS
# =============================================================================

statistics:
  # Tests estadísticos
  tests:
    group_comparison: "wilcoxon"      # "t.test" | "wilcoxon" | "permutation"
    multiple_correction: "BH"         # "BH" | "bonferroni" | "holm"
    alpha_level: 0.05                 # Nivel de significancia
  
  # Bootstrap y permutaciones
  resampling:
    n_bootstrap: 1000                 # Número de iteraciones bootstrap
    n_permutations: 1000              # Número de permutaciones
    seed: 42                          # Semilla para reproducibilidad
  
  # Modelos estadísticos
  models:
    use_mixed_effects: true           # Usar efectos mixtos para datos longitudinales
    random_effects: ["seq_id"]        # Efectos aleatorios

# =============================================================================
# CONFIGURACIÓN DE VISUALIZACIÓN
# =============================================================================

visualization:
  # Parámetros generales
  general:
    dpi: 300                          # Resolución de figuras
    width: 10                         # Ancho por defecto (inches)
    height: 8                         # Alto por defecto (inches)
    theme: "minimal"                  # Tema de ggplot2
  
  # Colores
  colors:
    cohorts:
      ALS: "#E31A1C"                 # Rojo para ALS
      control: "#1F78B4"             # Azul para Control
    mutation_types:
      "G>T": "#FF7F00"               # Naranja para G>T (oxidación)
      "PM": "#33A02C"                # Verde para Perfect Match
      other: "#6A3D9A"               # Púrpura para otros
  
  # Paletas
  palettes:
    heatmap: "RdBu"                  # Paleta para heatmaps
    continuous: "viridis"            # Paleta para variables continuas
    categorical: "Set3"              # Paleta para variables categóricas
  
  # Formatos de salida
  formats:
    figures: ["png", "pdf"]           # Formatos para figuras
    tables: ["csv", "tsv"]            # Formatos para tablas

# =============================================================================
# CONFIGURACIÓN DE ANÁLISIS AVANZADOS
# =============================================================================

advanced_analysis:
  # Clustering
  clustering:
    methods: ["hierarchical", "kmeans", "hdbscan"]  # Métodos de clustering
    distance_metric: "euclidean"      # Métrica de distancia
    linkage_method: "ward.D2"         # Método de linkage para clustering jerárquico
    n_clusters_range: [2, 10]         # Rango de clusters a evaluar
  
  # Análisis de vías
  pathway_analysis:
    target_prediction:
      methods: ["targetscan", "miranda"]  # Métodos de predicción de targets
      targetscan_version: "8.0"       # Versión de TargetScan
    enrichment:
      databases: ["GO", "KEGG", "Reactome"]  # Bases de datos para enriquecimiento
      pvalue_cutoff: 0.05             # Cutoff de p-valor
      qvalue_cutoff: 0.1              # Cutoff de q-valor (FDR)
  
  # Descubrimiento de motivos
  motif_discovery:
    kmer_sizes: [3, 4, 5, 6]         # Tamaños de k-mers a analizar
    g_richness_threshold: 0.6         # Threshold para G-richness
    min_motif_count: 5                # Mínimo número de ocurrencias del motivo

# =============================================================================
# CONFIGURACIÓN DE CONTROL DE CALIDAD
# =============================================================================

quality_control:
  # Detección de outliers
  outlier_detection:
    method: "iqr"                     # "iqr" | "zscore" | "isolation_forest"
    iqr_multiplier: 1.5               # Multiplicador IQR para outliers
    zscore_threshold: 3               # Threshold Z-score para outliers
  
  # Validación de datos
  data_validation:
    check_na_proportions: true        # Verificar proporciones de NA
    max_na_proportion: 0.5            # Máximo 50% de NAs por SNV
    check_duplicates: true            # Verificar duplicados
    check_negative_values: true       # Verificar valores negativos
  
  # Reportes de calidad
  quality_reports:
    generate_summary: true            # Generar resumen de calidad
    generate_plots: true              # Generar plots de calidad
    save_metadata: true               # Guardar metadata de calidad

# =============================================================================
# CONFIGURACIÓN DE REPORTES
# =============================================================================

reporting:
  # Formato de reportes
  format:
    summary_format: "text"            # "text" | "html" | "markdown"
    include_plots: true               # Incluir referencias a plots
    include_tables: true              # Incluir referencias a tablas
  
  # Contenido de reportes
  content:
    include_statistics: true          # Incluir estadísticas descriptivas
    include_interpretation: true      # Incluir interpretación de resultados
    include_recommendations: true     # Incluir recomendaciones
  
  # Metadatos
  metadata:
    include_timestamp: true           # Incluir timestamp
    include_version: true             # Incluir versión del pipeline
    include_parameters: true          # Incluir parámetros utilizados

# =============================================================================
# CONFIGURACIÓN DE RENDIMIENTO
# =============================================================================

performance:
  # Paralelización
  parallel:
    use_parallel: true                # Usar procesamiento paralelo
    n_cores: "auto"                   # Número de cores ("auto" o número)
    backend: "multicore"              # Backend para paralelización
  
  # Memoria
  memory:
    chunk_size: 10000                 # Tamaño de chunks para procesamiento
    gc_frequency: 100                 # Frecuencia de garbage collection
  
  # Caché
  cache:
    use_cache: true                   # Usar caché para resultados intermedios
    cache_dir: ".cache"               # Directorio de caché
    cache_expiry: 86400               # Expiración de caché en segundos (24h)

# =============================================================================
# CONFIGURACIÓN DE LOGGING
# =============================================================================

logging:
  # Nivel de logging
  level: "INFO"                       # "DEBUG" | "INFO" | "WARN" | "ERROR"
  
  # Destinos de logging
  destinations:
    console: true                     # Log a consola
    file: true                        # Log a archivo
    file_path: "logs/pipeline.log"    # Ruta del archivo de log
  
  # Formato de logging
  format:
    include_timestamp: true           # Incluir timestamp
    include_level: true               # Incluir nivel de log
    include_module: true              # Incluir módulo que genera el log

# =============================================================================
# CONFIGURACIÓN DE DESARROLLO Y DEBUGGING
# =============================================================================

development:
  # Modo debug
  debug:
    enabled: false                    # Habilitar modo debug
    verbose_output: true              # Output verboso
    save_intermediate: false          # Guardar resultados intermedios
  
  # Testing
  testing:
    use_example_data: false           # Usar datos de ejemplo para testing
    example_data_path: "data/example_input_mini.tsv"
    run_quick_tests: false            # Ejecutar tests rápidos
  
  # Validación
  validation:
    strict_mode: true                 # Modo estricto de validación
    stop_on_warning: false            # Parar en warnings
    validate_input: true              # Validar input al inicio







